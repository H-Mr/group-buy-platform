server:
  port: 8080 # 容器内部端口

# 线程池配置
thread:
  pool:
    # 1. 核心业务 DAG 专用
    dag:
      core-pool-size: 50
      max-pool-size: 200
      block-queue-size: 2000
      keep-alive-time: 5000
      name-prefix: "dag-exec-"
      reject-policy: CallerRunsPolicy
    # 2. 消息通知 EventBus 专用
    notify:
      core-pool-size: 5
      max-pool-size: 20
      block-queue-size: 500
      keep-alive-time: 5000
      name-prefix: "event-bus-"
      reject-policy: CallerRunsPolicy
    # 3. 通用异步任务专用
    common:
      core-pool-size: 5
      max-pool-size: 20
      block-queue-size: 500
      keep-alive-time: 5000
      name-prefix: "async-task-"
      reject-policy: CallerRunsPolicy

# 应用配置
app:
  config:
    # 版本，方便通过接口版本升级
    api-version: v1
    # 跨域，开发阶段可以设置为 * 不限制
    cross-origin: '*'
    # SC 渠道配置 - 拼团对接渠道值、回调通知
    group-buy-market:
      api-url: http://${SERVER_HOST}:8080 # 未启用，扩展使用
      notify-url: http://${SERVER_HOST}:8080/api/v1/alipay/group_buy_notify # 未启用，扩展使用
      source: s01
      chanel: c01


# 数据库配置；启动时配置数据库资源信息
spring:
  datasource:
    username: root
    password: ${MYSQL_ROOT_PASSWORD}
    url: jdbc:mysql://mysql:3306/group_buy_market?useUnicode=true&characterEncoding=utf8&autoReconnect=true&zeroDateTimeBehavior=convertToNull&serverTimezone=Asia/Shanghai&useSSL=true
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      pool-name: Retail_HikariCP
      minimum-idle: 15 #最小空闲连接数量
      idle-timeout: 180000 #空闲连接存活最大时间，默认600000（10分钟）
      maximum-pool-size: 25 #连接池最大连接数，默认是10
      auto-commit: true  #此属性控制从池返回的连接的默认自动提交行为,默认值：true
      max-lifetime: 1800000 #此属性控制池中连接的最长生命周期，值0表示无限生命周期，默认1800000即30分钟
      connection-timeout: 30000 #数据库连接超时时间,默认30秒，即30000
      leak-detection-threshold: 30000 # 单位毫秒（建议设置为业务最长执行时间的2倍，如30秒=30000）
      connection-test-query: SELECT 1
    type: com.zaxxer.hikari.HikariDataSource

# MyBatis 配置
mybatis:
  mapper-locations: classpath:/mybatis/mapper/*.xml
  config-location:  classpath:/mybatis/config/mybatis-config.xml
  type-aliases-package: cn.hjw.dev.infrastructure.dao.po


# Redisson 客户端配置
redis:
  sdk:
    config:
      host: redis
      port: 6379
      pool-size: 10
      password: ${REDIS_PASSWORD}
      min-idle-size: 5
      idle-timeout: 30000
      connect-timeout: 5000
      retry-attempts: 3
      retry-interval: 1000
      ping-interval: 60000
      keep-alive: true

# 微信公众号对接
weixin:
  config:
    originalid: gh_d64dcc5d0a60
    token: b8b6
    app-id: wx48a01514c5bc10e7
    app-secret: ${WEIXIN_APP_SECRET}
    template_id: luFYa6dPjgxv3Adr6tIxeXgxtXT2er2jwSGprZb-S5w


jwt:
  secret: ${JWT_SECRET}
  expire: 7200 # Token有效期（秒）(2小时)


# 支付宝支付 - 沙箱 https://opendocs.alipay.com/common/02kkv7
alipay:
  enabled: true
  app_id: 9021000157621491
  alipay_public_key: MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAo4OqPqOlkFX9buHWXdYlrtq3jVPl4Bsk3kpinDihzmjXTnF2rWBOUxmDWQ/caSt76+XqSuEp9ZQHP03Qwog1dq7Kjes46BtlfCyDA4HeMtjtF8QGCZjVCGzFH+mKhygRF+YWSKqakuD56Lkm3mtz8UVn8U1ZgAw5u5MXkqv6OS6AG1YDRBT/kZTHIYwjgR8d1WufJYS9V/SPSQaXTvlSd3eyieI4De+giNcX5e9axY7VBQvjzY1po0MuzHxvOBsHnEV4bTtxORu0CpHX9YufsUYTFjU6cxqNbLr02rpu6JmfX7XOuGALGIt+TvtmHYhL0zGbryjJMx+dcUsLqpqGtQIDAQAB
  merchant_private_key: ${ALIPAY_PRIVATE_KEY}
  gatewayUrl: https://openapi-sandbox.dl.alipaydev.com/gateway.do
  notify_url: http://${SERVER_HOST}:8080/api/v1/alipay/alipay_notify_url
  return_url:  http://${SERVER_HOST}:8080/success.html



# 日志
logging:
  level:
    root: info
    cn.hjw.dev: info
  file:
    path: logs
  config: classpath:logback-spring.xml


# Spring Boot Actuator 配置（健康检查核心）
management:
  endpoints:
    web:
      exposure:
        include: health  # 暴露健康检查端点（生产环境仅暴露必要端点，避免安全风险）
      base-path: /actuator  # 端点根路径（默认就是/actuator，可省略）
  endpoint:
    health:
      show-details: always  # 显示健康检查详情（方便调试，生产可改为when_authorized）
  health:
    redis:
      enabled: true  # 检查Redis连接状态
    db:
      enabled: true  # 检查MySQL数据库连接状态